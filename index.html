function updatePageWithConfig(data) {
    console.log('Updating page with config data:', data);
    
    const config = data.site_config; 
    if (!config) {
        console.error('site_config object not found in the response data.');
        showErrorMessage('Configuration data is missing in the response.');
        return;
    }

    // Update title & metadata
    document.title = config.about_title || 'Portfolio';
    const favicon = document.querySelector('link[rel="icon"]');
    if (favicon && config.image_favicon_url) {
        favicon.href = config.image_favicon_url;
    }
    
    // Update header logo
    const logoImg = document.querySelector('.navbar .logo img'); // Verified correct selector
    if (logoImg && config.image_logo_url) {
        logoImg.src = config.image_logo_url;
        logoImg.alt = config.about_title || 'Logo';
    }
    
    // Update about section
    const aboutTitle = document.getElementById('about-title');
    const aboutSubtitle = document.getElementById('about-subtitle');
    const aboutDescription = document.getElementById('about-description');
    const profileImage = document.getElementById('profile-image');
                
    if (aboutTitle) {
        aboutTitle.textContent = config.about_title || '';
    }
    
    if (aboutSubtitle) {
        aboutSubtitle.textContent = config.about_subtitle || '';
    }
    
    if (aboutDescription) {
        aboutDescription.textContent = config.about_description || '';
        aboutDescription.style.textAlign = 'left';
    }
                
    if (profileImage) {
        profileImage.src = config.image_about_profile_url || '';
        profileImage.alt = config.about_title ? `${config.about_title}'s Profile` : 'Profile Photo';
    }
                
    // Update photos in the "snaps" section
    const snapsContainer = document.getElementById('snaps');
    if (snapsContainer) {
        // Clear existing content
        snapsContainer.innerHTML = '';
                    
        // Create photos array from config
        const photos = [
            { url: config.image_about_photo1_url, alt: config.about_photo1_alt },
            { url: config.image_about_photo2_url, alt: config.about_photo2_alt },
            { url: config.image_about_photo3_url, alt: config.about_photo3_alt },
            { url: config.image_about_photo4_url, alt: config.about_photo4_alt }
        ];
        
        // Add photos to container if they have URLs
        photos.forEach(photo => {
            if (photo.url) {
                const container = document.createElement('a');
                container.href = '#';
                container.className = 'snap-container';
                container.setAttribute('data-photo', photo.url);
                        
                const img = document.createElement('img');
                img.src = photo.url;
                img.alt = photo.alt || 'Photo';
                        
                container.appendChild(img);
                snapsContainer.appendChild(container);
            }
        });
                    
        // Reinitialize the modal functionality AFTER adding snaps
        initializeModalFunctionality(); 
    }
    
    // Show content once loaded
    document.body.classList.add('content-loaded');
}

function initializeModalFunctionality() {
    const modal = document.getElementById('photoModal');
    const modalImg = document.getElementById('modalImage');
    const closeModalButton = document.querySelector('.close-modal'); // Use a distinct name
    const snapContainers = document.querySelectorAll('.snap-container'); // Select ALL snaps

    // Check if essential modal elements exist
    if (!modal || !modalImg || !closeModalButton) {
        console.error('Modal elements not found (modal, modalImg, or close button). Cannot initialize modal functionality.');
        return;
    }

    console.log(`Initializing modal. Found ${snapContainers.length} snap containers.`);
    
    // --- Event Listeners --- 

    // Open modal when clicking on ANY snap container
    snapContainers.forEach(function(container) {
        // Remove any old listeners first to prevent duplicates if called multiple times
        container.replaceWith(container.cloneNode(true)); // Simple way to remove listeners
    });
    // Re-select containers after cloning
    document.querySelectorAll('.snap-container').forEach(function(container) { 
        container.addEventListener('click', function(e) {
            e.preventDefault();
            const photoUrl = this.getAttribute('data-photo');
            console.log('Snap clicked, opening modal for:', photoUrl);
            modal.style.display = 'block';
            modalImg.src = photoUrl;
            // Add error handling for modal image load if needed 
            modalImg.onerror = function() {
                console.error("Error loading modal image: " + this.src);
                this.onerror = null; 
                this.src = '/static/img/placeholder.png'; // Fallback
            };
        });
    });

    // Close modal when clicking on close button
    // Remove potential old listener before adding
    const newCloseModalButton = closeModalButton.cloneNode(true);
    closeModalButton.parentNode.replaceChild(newCloseModalButton, closeModalButton);
    newCloseModalButton.addEventListener('click', function() {
        console.log('Close button clicked');
        modal.style.display = 'none';
    });

    // Close modal when clicking outside the image (on the backdrop)
    // Use a more specific check to avoid conflicts
    modal.addEventListener('click', function(e) {
        if (e.target === modal) { // Only close if the click is directly on the modal backdrop
             console.log('Modal backdrop clicked');
             modal.style.display = 'none';
        }
    });
}

// Close modal with Escape key (Keep this listener global)
document.addEventListener('keydown', function(e) {
    const modal = document.getElementById('photoModal');
    // Check if modal exists and is visible
    if (modal && modal.style.display === 'block' && e.key === 'Escape') {
        console.log('Escape key pressed');
        modal.style.display = 'none';
    }
});

// Global definitions to handle cached/old code
let closeModal = document.querySelector('.close-modal'); // Define globally to prevent errors in old code

// Set banner image as soon as DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    const bannerImage = document.getElementById('banner-image');
    if (bannerImage) {
        // Set the banner image dynamically IF the API provides it later
        // bannerImage.style.backgroundImage = "url('...')"; // Done in updatePageWithConfig
        
        // Ensure correct base styling (fallback)
        bannerImage.style.backgroundSize = 'contain';
        bannerImage.style.backgroundPosition = 'center';
        bannerImage.style.backgroundRepeat = 'no-repeat';
        bannerImage.style.width = '100%';
        bannerImage.style.height = '0';
        bannerImage.style.paddingBottom = '38.75%'; // Maintain aspect ratio
    }

    // Try to fetch the latest content from our AWS Lambda endpoint
    fetchLatestAboutContent();
    
    // Initialize modal functionality for elements present on initial load (if any)
    // Note: This is likely re-initialized after API content is loaded
    initializeModalFunctionality(); 

    // Refresh the global closeModal reference once DOM is fully loaded
    closeModal = document.querySelector('.close-modal');
});

// Function to fetch the latest content from our API
function fetchLatestAboutContent() {
    console.log('Checking for latest content from API');
    
    const apiUrl = 'https://zelbc2vwg2.execute-api.eu-north-1.amazonaws.com/Staging/website-portfolio?type=site_config';
    
    fetch(apiUrl)
        .then(response => {
            console.log('API response status:', response.status);
            if (!response.ok) {
                throw new Error(`API response not OK: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            console.log('Successfully loaded site config from API:', data);
            // Pass the raw data object
            updatePageWithConfig(data); 
        })
        .catch(error => {
            console.error('Error loading from API:', error);
            showErrorMessage('Error loading configuration. Please refresh or try again later.');
        });
}

function showErrorMessage(message) {
    // Create and show error message element (code omitted for brevity)
    const errorDiv = document.createElement('div');
    errorDiv.style.position = 'fixed';
    errorDiv.style.top = '20px';
    errorDiv.style.right = '20px';
    errorDiv.style.backgroundColor = '#f44336';
    errorDiv.style.color = 'white';
    errorDiv.style.padding = '15px';
    errorDiv.style.borderRadius = '5px';
    errorDiv.style.zIndex = '1000';
    errorDiv.textContent = message;
    document.body.appendChild(errorDiv);
    setTimeout(() => {
        errorDiv.style.opacity = '0';
        errorDiv.style.transition = 'opacity 0.5s';
        setTimeout(() => document.body.removeChild(errorDiv), 500);
    }, 5000);
}

// Add script for logo background that can't be done with inline styles
document.addEventListener('DOMContentLoaded', function() {
    // Add the pseudo-element effect that can't be done with inline styles
    const logoElement = document.querySelector('.logo');
    if (logoElement) {
        // Create a div that will act as our :before pseudo-element
        const beforeElement = document.createElement('div');
        beforeElement.style.position = 'absolute';
        beforeElement.style.top = '-6px';
        beforeElement.style.left = '-3px';
        beforeElement.style.right = '-3px';
        beforeElement.style.bottom = '-6px';
        beforeElement.style.backgroundColor = 'rgba(0, 0, 0, 0.6)';
        beforeElement.style.borderRadius = '8px';
        beforeElement.style.zIndex = '-1';
        
        // Insert as first child to be below the logo
        if (!logoElement.querySelector(':scope > div[style*="z-index: -1"]')) { // Prevent adding duplicates
             logoElement.insertBefore(beforeElement, logoElement.firstChild);
        }
    }
});
</script>

</body></html> 