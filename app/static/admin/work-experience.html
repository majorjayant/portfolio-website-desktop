<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Experience | Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                    }
                }
            }
        }
    </script>
    <style>
        .experience-item {
            transition: all 0.3s ease;
        }
        .experience-item.deleted {
            opacity: 0.6;
            background-color: #f9f9f9;
            border-color: #ccc !important;
            position: relative;
        }
        .experience-item.deleted::before {
            content: "MARKED FOR DELETION";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(-20deg);
            font-size: 24px;
            color: rgba(220, 38, 38, 0.8);
            font-weight: bold;
            text-transform: uppercase;
            border: 3px solid rgba(220, 38, 38, 0.8);
            padding: 10px;
            z-index: 10;
            pointer-events: none;
        }
        .progress-bar {
            height: 8px;
            background-color: #E5E7EB;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-value {
            height: 100%;
            background-color: #3B82F6;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-gray-100">
    <div id="header-container"></div>

    <main class="flex-grow p-6">
        <div class="max-w-7xl mx-auto">
            <!-- Work Experience Section -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-semibold">Work Experience</h2>
                    <button id="add-experience-btn" class="px-4 py-2 bg-blue-500 text-white font-medium rounded-md hover:bg-blue-600 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Add Experience
                    </button>
                </div>
                
                <div id="experience-items-container" class="space-y-5">
                    <!-- Experience items will be added here dynamically -->
                </div>
                
                <div class="flex justify-end mt-6">
                    <button id="save-experience-btn" class="px-6 py-2 bg-green-500 text-white font-medium rounded-md hover:bg-green-600 transition-colors">
                        <i class="fas fa-save mr-2"></i>Save Experience
                    </button>
                </div>
            </div>
        </div>
    </main>

    <div id="footer-container"></div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <div class="flex items-center">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 mr-3"></div>
                <p>Loading...</p>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div id="notification" class="fixed top-4 right-4 p-4 rounded-md shadow-md transform transition-transform duration-300 translate-x-full z-50">
        <div class="flex items-center">
            <i id="notification-icon" class="fas mr-2"></i>
            <p id="notification-message"></p>
        </div>
    </div>

    <script src="js/admin-utils.js"></script>
    <script>
        // Load header and footer components
        fetch('components/header.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('header-container').innerHTML = data;
                const currentPage = 'work-experience'; 
                document.querySelector(`.nav-link[data-page="${currentPage}"]`).classList.add('bg-gray-200');
            });

        fetch('components/footer.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('footer-container').innerHTML = data;
            });

        // Work Experience Functions
        function addExperienceItem(data = {}) {
            const container = document.getElementById('experience-items-container');
            // Use the existing ID from data if available, otherwise generate a temporary one
            const itemId = data.id || ('temp_' + Date.now()); // Use database ID or generate unique temp ID
            
            const itemDiv = document.createElement('div');
            itemDiv.className = 'experience-item border rounded-lg p-4 ' + (data.deleted ? 'deleted' : '');
            itemDiv.setAttribute('data-id', itemId);
            itemDiv.setAttribute('data-deleted', data.deleted ? 'true' : 'false');
            
            // Log the item being added for debugging
            console.log(`Adding experience item with ID: ${itemId}`, data);
            
            itemDiv.innerHTML = `
                <div class="flex justify-between items-start mb-3">
                    <h3 class="text-lg font-medium">Experience Item ${itemId.toString().includes('temp_') ? '(New)' : `#${itemId}`}</h3>
                    <div class="flex space-x-2">
                        <button class="move-up-btn px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                            <i class="fas fa-arrow-up"></i>
                        </button>
                        <button class="move-down-btn px-2 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300">
                            <i class="fas fa-arrow-down"></i>
                        </button>
                        <button class="toggle-delete-btn px-2 py-1 ${data.deleted ? 'bg-blue-500 text-white' : 'bg-red-500 text-white'} rounded hover:opacity-80">
                            ${data.deleted ? '<i class="fas fa-undo"></i>' : '<i class="fas fa-trash"></i>'}
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Company Name*</label>
                        <input type="text" class="company-name w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                            value="${data.company || ''}" ${data.deleted ? 'disabled' : ''}>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Position*</label>
                        <input type="text" class="position w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                            value="${data.position || ''}" ${data.deleted ? 'disabled' : ''}>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Start Date*</label>
                        <input type="date" class="start-date w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                            value="${data.startDate || ''}" ${data.deleted ? 'disabled' : ''}>
                    </div>
                    
                    <div class="end-date-container">
                        <label class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                        <div class="flex items-center">
                            <input type="date" class="end-date w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                value="${data.endDate || ''}" ${data.current || data.deleted ? 'disabled' : ''}>
                            <div class="ml-2 flex items-center">
                                <input type="checkbox" class="current-job h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" 
                                    ${data.current ? 'checked' : ''} ${data.deleted ? 'disabled' : ''}>
                                <label class="ml-1 text-sm text-gray-700">Current</label>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Location</label>
                        <input type="text" class="location w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                            value="${data.location || ''}" ${data.deleted ? 'disabled' : ''}>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Company URL</label>
                        <input type="url" class="company-url w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                            value="${data.companyUrl || ''}" ${data.deleted ? 'disabled' : ''}>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description*</label>
                    <textarea class="description w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        rows="4" ${data.deleted ? 'disabled' : ''}>${data.description || ''}</textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Key Responsibilities & Achievements</label>
                    <div class="responsibilities-container space-y-2">
                        ${generateResponsibilitiesHTML(data.responsibilities || [], data.deleted)}
                    </div>
                    <button class="add-responsibility-btn mt-2 px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300" 
                        ${data.deleted ? 'disabled' : ''}>
                        <i class="fas fa-plus mr-1"></i>Add Responsibility
                    </button>
                </div>
                
                <div class="mt-4">
                    <label class="block text-sm font-medium text-gray-700 mb-1">Technologies Used</label>
                    <div class="technologies-container space-y-2">
                        ${generateTechnologiesHTML(data.technologies || [], data.deleted)}
                    </div>
                    <button class="add-technology-btn mt-2 px-3 py-1 bg-gray-200 text-gray-700 text-sm rounded hover:bg-gray-300" 
                        ${data.deleted ? 'disabled' : ''}>
                        <i class="fas fa-plus mr-1"></i>Add Technology
                    </button>
                </div>
            `;
            
            container.appendChild(itemDiv);
            
            // Add event listeners
            const currentJobCheckbox = itemDiv.querySelector('.current-job');
            const endDateInput = itemDiv.querySelector('.end-date');
            
            if (currentJobCheckbox) {
                currentJobCheckbox.addEventListener('change', function() {
                    endDateInput.disabled = this.checked;
                    if (this.checked) {
                        endDateInput.value = '';
                    }
                });
            }
            
            const addResponsibilityBtn = itemDiv.querySelector('.add-responsibility-btn');
            if (addResponsibilityBtn) {
                addResponsibilityBtn.addEventListener('click', function() {
                    addResponsibilityItem(this.parentElement.querySelector('.responsibilities-container'), '');
                });
            }
            
            const addTechnologyBtn = itemDiv.querySelector('.add-technology-btn');
            if (addTechnologyBtn) {
                addTechnologyBtn.addEventListener('click', function() {
                    addTechnologyItem(this.parentElement.querySelector('.technologies-container'), '');
                });
            }
            
            const toggleDeleteBtn = itemDiv.querySelector('.toggle-delete-btn');
            if (toggleDeleteBtn) {
                toggleDeleteBtn.addEventListener('click', function() {
                    toggleDeleteItem(itemDiv);
                });
            }
            
            const moveUpBtn = itemDiv.querySelector('.move-up-btn');
            if (moveUpBtn) {
                moveUpBtn.addEventListener('click', function() {
                    moveItemUp(itemDiv);
                });
            }
            
            const moveDownBtn = itemDiv.querySelector('.move-down-btn');
            if (moveDownBtn) {
                moveDownBtn.addEventListener('click', function() {
                    moveItemDown(itemDiv);
                });
            }
        }

        function generateResponsibilitiesHTML(responsibilities, isDisabled) {
            if (!responsibilities || responsibilities.length === 0) {
                return addResponsibilityItem(null, '', isDisabled, true);
            }
            
            let html = '';
            responsibilities.forEach(responsibility => {
                html += addResponsibilityItem(null, responsibility, isDisabled, true);
            });
            
            return html;
        }

        function addResponsibilityItem(container, value = '', isDisabled = false, returnHTML = false) {
            const html = `
                <div class="responsibility-item flex items-center">
                    <input type="text" class="responsibility w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        value="${value}" ${isDisabled ? 'disabled' : ''}>
                    <button class="remove-responsibility-btn ml-2 px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200" 
                        ${isDisabled ? 'disabled' : ''}>
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            if (returnHTML) {
                return html;
            }
            
            if (container) {
                container.insertAdjacentHTML('beforeend', html);
                const newItem = container.lastElementChild;
                const removeBtn = newItem.querySelector('.remove-responsibility-btn');
                
                if (removeBtn) {
                    removeBtn.addEventListener('click', function() {
                        newItem.remove();
                    });
                }
            }
        }

        function generateTechnologiesHTML(technologies, isDisabled) {
            if (!technologies || technologies.length === 0) {
                return addTechnologyItem(null, '', isDisabled, true);
            }
            
            let html = '';
            technologies.forEach(technology => {
                html += addTechnologyItem(null, technology, isDisabled, true);
            });
            
            return html;
        }

        function addTechnologyItem(container, value = '', isDisabled = false, returnHTML = false) {
            const html = `
                <div class="technology-item flex items-center">
                    <input type="text" class="technology w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                        value="${value}" ${isDisabled ? 'disabled' : ''}>
                    <button class="remove-technology-btn ml-2 px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200" 
                        ${isDisabled ? 'disabled' : ''}>
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            if (returnHTML) {
                return html;
            }
            
            if (container) {
                container.insertAdjacentHTML('beforeend', html);
                const newItem = container.lastElementChild;
                const removeBtn = newItem.querySelector('.remove-technology-btn');
                
                if (removeBtn) {
                    removeBtn.addEventListener('click', function() {
                        newItem.remove();
                    });
                }
            }
        }

        function toggleDeleteItem(itemDiv) {
            const isDeleted = itemDiv.getAttribute('data-deleted') === 'true';
            const newState = !isDeleted;
            const itemId = itemDiv.getAttribute('data-id');
            
            // Prompt for confirmation when deleting an item with a real ID
            if (newState && !itemId.toString().includes('temp_')) {
                if (!confirm('Are you sure you want to mark this item for deletion? The item will be permanently removed when you save.')) {
                    return;
                }
            }
            
            itemDiv.setAttribute('data-deleted', newState);
            
            if (newState) {
                // Mark for deletion
                itemDiv.classList.add('deleted');
                itemDiv.querySelectorAll('input, textarea, select, button:not(.toggle-delete-btn)').forEach(element => {
                    element.disabled = true;
                });
                
                const toggleBtn = itemDiv.querySelector('.toggle-delete-btn');
                toggleBtn.classList.remove('bg-red-500');
                toggleBtn.classList.add('bg-blue-500');
                toggleBtn.innerHTML = '<i class="fas fa-undo"></i>';
                toggleBtn.title = "Undo deletion";
            } else {
                // Restore from deletion
                itemDiv.classList.remove('deleted');
                itemDiv.querySelectorAll('input, textarea, select, button:not(.toggle-delete-btn)').forEach(element => {
                    // Handle special case for end date
                    if (element.classList.contains('end-date')) {
                        const currentCheckbox = itemDiv.querySelector('.current-job');
                        if (currentCheckbox && currentCheckbox.checked) {
                            return; // Keep end date disabled if "current" is checked
                        }
                    }
                    element.disabled = false;
                });
                
                const toggleBtn = itemDiv.querySelector('.toggle-delete-btn');
                toggleBtn.classList.remove('bg-blue-500');
                toggleBtn.classList.add('bg-red-500');
                toggleBtn.innerHTML = '<i class="fas fa-trash"></i>';
                toggleBtn.title = "Mark for deletion";
            }
            
            console.log(`Item with ID ${itemId} ${newState ? 'marked for deletion' : 'restored'}`);
        }

        function moveItemUp(itemDiv) {
            const prevItem = itemDiv.previousElementSibling;
            if (prevItem) {
                itemDiv.parentNode.insertBefore(itemDiv, prevItem);
            }
        }

        function moveItemDown(itemDiv) {
            const nextItem = itemDiv.nextElementSibling;
            if (nextItem) {
                itemDiv.parentNode.insertBefore(nextItem, itemDiv);
            }
        }

        function validateExperienceForm() {
            let isValid = true;
            const items = document.querySelectorAll('.experience-item:not(.deleted)');
            
            items.forEach(item => {
                const companyInput = item.querySelector('.company-name');
                const positionInput = item.querySelector('.position');
                const startDateInput = item.querySelector('.start-date');
                const descriptionInput = item.querySelector('.description');
                
                const requiredInputs = [companyInput, positionInput, startDateInput, descriptionInput];
                
                requiredInputs.forEach(input => {
                    if (!input.value.trim()) {
                        input.classList.add('border-red-500');
                        isValid = false;
                    } else {
                        input.classList.remove('border-red-500');
                    }
                });
            });
            
            return isValid;
        }

        function getExperienceData() {
            const items = document.querySelectorAll('.experience-item');
            const data = [];
            
            items.forEach(item => {
                // Get the item ID from the data attribute
                const itemId = item.getAttribute('data-id');
                // Extract numeric ID if it's a database ID (not a temp ID)
                const numericId = itemId && !itemId.toString().includes('temp_') ? parseInt(itemId, 10) : null;
                
                // Get deletion status
                const isDeleted = item.getAttribute('data-deleted') === 'true';
                
                // For deleted items with a valid numeric ID, include them with is_deleted flag
                // Skip temporary items that were marked for deletion
                if (isDeleted && !numericId) {
                    return; // Skip temporary items that were deleted
                }
                
                const companyInput = item.querySelector('.company-name');
                const positionInput = item.querySelector('.position');
                const startDateInput = item.querySelector('.start-date');
                const endDateInput = item.querySelector('.end-date');
                const currentJobCheckbox = item.querySelector('.current-job');
                const locationInput = item.querySelector('.location');
                const companyUrlInput = item.querySelector('.company-url');
                const descriptionInput = item.querySelector('.description');
                
                const responsibilityItems = Array.from(item.querySelectorAll('.responsibility-item'));
                const responsibilities = responsibilityItems.map(respItem => {
                    const input = respItem.querySelector('.responsibility');
                    return input.value.trim();
                }).filter(text => text !== '');
                
                const technologyItems = Array.from(item.querySelectorAll('.technology-item'));
                const technologies = technologyItems.map(techItem => {
                    const input = techItem.querySelector('.technology');
                    return input.value.trim();
                }).filter(text => text !== '');
                
                data.push({
                    id: numericId,
                    company: companyInput.value.trim(),
                    position: positionInput.value.trim(),
                    startDate: startDateInput.value,
                    endDate: currentJobCheckbox.checked ? null : endDateInput.value,
                    current: currentJobCheckbox.checked,
                    location: locationInput.value.trim(),
                    companyUrl: companyUrlInput.value.trim(),
                    description: descriptionInput.value.trim(),
                    is_deleted: isDeleted ? 1 : 0, // Convert to numeric format for Lambda
                    responsibilities: responsibilities,
                    technologies: technologies
                });
            });
            
            return data;
        }

        async function loadWorkExperience() {
            showLoading(true);
            try {
                // Use the proper API endpoint with format expected by Lambda function
                const response = await fetchFromAPI(`?type=work&action=get_site_config`);
                
                if (response && response.work_experience && Array.isArray(response.work_experience)) {
                    const container = document.getElementById('experience-items-container');
                    container.innerHTML = ''; // Clear container
                    
                    if (response.work_experience.length === 0) {
                        // Add empty experience item if no experience exists
                        addExperienceItem();
                    } else {
                        // Add experience items from data, map field names to our expected structure
                        response.work_experience.forEach(item => {
                            const experienceItem = {
                                id: item.id || null,
                                company: item.company_name || '',
                                position: item.job_title || '',
                                startDate: item.from_date || '',
                                endDate: item.to_date || '',
                                current: item.is_current || false,
                                location: item.location || '',
                                description: item.description || '',
                                // These might not be in the database yet
                                companyUrl: item.company_url || '',
                                responsibilities: item.responsibilities || [],
                                technologies: item.technologies || []
                            };
                            addExperienceItem(experienceItem);
                        });
                    }
                    console.log('Successfully loaded work experience data from API');
                } else {
                    throw new Error('Invalid work experience data structure from API');
                }
            } catch (error) {
                console.error('Error loading work experience:', error);
                showNotification('Failed to load work experience', 'error');
                
                // Load local JSON data as fallback
                try {
                    const localResponse = await fetch('../data/experience.json');
                    if (localResponse.ok) {
                        const data = await localResponse.json();
                        
                        const container = document.getElementById('experience-items-container');
                        container.innerHTML = ''; // Clear container
                        
                        if (!data || data.length === 0) {
                            // Add empty experience item if no experience exists
                            addExperienceItem();
                        } else {
                            // Add experience items from data, map fields to expected format
                            data.forEach(item => {
                                const experienceItem = {
                                    id: item.id || null,
                                    company: item.company || '',
                                    position: item.job_title || '',
                                    startDate: item.start_date || '',
                                    endDate: item.end_date || '',
                                    current: !item.end_date,
                                    location: item.location || '',
                                    description: item.description || '',
                                    // These fields might not be in local JSON
                                    companyUrl: '',
                                    responsibilities: [],
                                    technologies: []
                                };
                                addExperienceItem(experienceItem);
                            });
                        }
                    }
                } catch (localError) {
                    console.error('Error loading local work experience:', localError);
                    // Add empty experience item if everything fails
                    const container = document.getElementById('experience-items-container');
                    container.innerHTML = ''; // Clear container
                    addExperienceItem();
                }
            } finally {
                showLoading(false);
            }
        }

        async function saveWorkExperience() {
            if (!validateExperienceForm()) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            const formData = getExperienceData();
            console.log('Experience Form Data:', formData);
            
            // Check if we have any items to save
            if (formData.length === 0) {
                showNotification('No experience items to save', 'error');
                return;
            }
            
            // Transform to the format expected by Lambda
            const workExperienceData = formData.map(item => {
                return {
                    id: item.id || null,
                    job_title: item.position,
                    company_name: item.company,
                    location: item.location,
                    from_date: item.startDate,
                    to_date: item.current ? null : item.endDate,
                    is_current: item.current ? 1 : 0,
                    description: item.description,
                    // Get the is_deleted flag
                    is_deleted: item.is_deleted || 0
                };
            });
            
            // Summary information for user feedback
            const totalItems = workExperienceData.length;
            const newItems = workExperienceData.filter(item => !item.id).length;
            const updatedItems = workExperienceData.filter(item => item.id && item.is_deleted === 0).length;
            const deletedItems = workExperienceData.filter(item => item.id && item.is_deleted === 1).length;
            
            // Confirm deletion if there are items marked for deletion
            if (deletedItems > 0) {
                if (!confirm(`You have marked ${deletedItems} item(s) for deletion. This cannot be undone. Continue?`)) {
                    return;
                }
            }
            
            showLoading(true);
            try {
                // Construct the payload in the format expected by the lambda function
                const payload = {
                    work_experience: workExperienceData
                };
                
                const response = await fetchFromAPI(`?type=config&action=save_config_all`, {
                    method: 'POST',
                    body: JSON.stringify(payload)
                });
                
                if (response && response.success) {
                    // Show detailed success message
                    const message = `Successfully saved work experience: ${newItems} new, ${updatedItems} updated, ${deletedItems} deleted`;
                    console.log(message);
                    showNotification(message);
                    
                    // Reload the data to refresh IDs and remove deleted items
                    setTimeout(() => {
                        loadWorkExperience();
                    }, 1000);
                } else {
                    throw new Error(response?.message || 'Failed to save work experience');
                }
            } catch (error) {
                console.error('Error saving work experience:', error);
                showNotification('Failed to save work experience: ' + error.message, 'error');
            } finally {
                showLoading(false);
            }
        }

        function initWorkExperiencePage() {
            // Load work experience
            loadWorkExperience();
            
            // Add experience button
            document.getElementById('add-experience-btn').addEventListener('click', function() {
                addExperienceItem();
            });
            
            // Save experience button
            document.getElementById('save-experience-btn').addEventListener('click', saveWorkExperience);
            
            // Remove error indicator when user starts typing
            document.addEventListener('input', function(event) {
                if (event.target.tagName === 'INPUT' || event.target.tagName === 'TEXTAREA') {
                    event.target.classList.remove('border-red-500');
                }
            });
        }

        // Initialize page
        initPage(initWorkExperiencePage);
    </script>
</body>
</html> 