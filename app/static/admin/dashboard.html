<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .hidden {
            display: none !important;
        }
        
        /* Work Experience Item Styling */
        .workex-item {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.375rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .workex-item label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.5rem;
        }
        
        .workex-item input[type="text"],
        .workex-item input[type="date"] {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            background-color: white;
            font-size: 0.875rem;
        }
        
        .workex-item textarea {
            width: 100%;
            padding: 0.5rem 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            min-height: 100px;
            background-color: white;
            font-size: 0.875rem;
            resize: vertical;
        }
        
        .workex-dates {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .workex-current {
            display: flex;
            align-items: center;
            margin-top: 0.5rem;
            grid-column: span 2;
        }
        
        .workex-current label {
            display: inline;
            margin-right: 0.5rem;
            margin-bottom: 0;
        }
        
        .workex-delete-btn {
            display: inline-block;
            background-color: #ef4444;
            color: white;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            border: none;
            cursor: pointer;
            margin-top: 0.5rem;
        }
        
        .workex-delete-btn:hover {
            background-color: #dc2626;
        }
        
        /* Work experience error message styling */
        .error-message {
            color: #ef4444;
            background-color: #fee2e2;
            padding: 0.75rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
        }
        
        /* Responsive adjustments */
        @media (max-width: 640px) {
            .workex-dates {
                grid-template-columns: 1fr;
            }
            
            .workex-current {
                grid-column: 1;
            }
        }
        
        .marked-for-deletion {
            opacity: 0.6;
            background-color: #fee2e2 !important; /* Light red background */
            border: 1px dashed #f87171;
        }
        .marked-for-deletion input, .marked-for-deletion textarea {
             text-decoration: line-through;
             background-color: #fecaca !important;
        }
        .marked-for-deletion .workex-delete-btn {
             background-color: #9ca3af !important;
             cursor: not-allowed;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen bg-gray-100">
        <!-- Authentication check -->
        <div id="auth-loading" class="fixed inset-0 flex items-center justify-center bg-white z-50">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto mb-4"></div>
                <p class="text-lg text-gray-600">Verifying authentication...</p>
            </div>
        </div>
        
        <!-- Not Authenticated Message -->
        <div id="not-authenticated" class="hidden fixed inset-0 flex items-center justify-center bg-white z-50">
            <div class="text-center">
                <div class="text-red-600 text-6xl mb-4">⚠️</div>
                <p class="text-lg text-gray-800 mb-4">You need to log in to access this page</p>
                <a href="/admin/login" class="inline-block px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">
                    Go to Login
                </a>
            </div>
        </div>
        
        <!-- API Error Message -->
        <div id="api-error" class="hidden fixed top-4 right-4 p-4 bg-red-100 text-red-700 rounded-md shadow-md z-40">
            Error loading data. Please try again later.
        </div>
        
        <!-- Dashboard Content (hidden until authenticated) -->
        <div id="dashboard-content" class="hidden">
            <!-- Navigation -->
            <nav class="bg-indigo-600 shadow">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="flex justify-between h-16">
                        <div class="flex">
                            <div class="flex-shrink-0 flex items-center">
                                <span class="text-white text-xl font-bold">Admin Dashboard</span>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <a href="/admin" class="px-3 py-2 rounded-md text-sm font-medium text-white hover:bg-indigo-700">
                                Admin Home
                            </a>
                            <button id="logout-button" class="px-3 py-2 rounded-md text-sm font-medium text-white bg-indigo-700 hover:bg-indigo-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                Logout
                            </button>
                        </div>
                    </div>
                </div>
            </nav>
            
            <!-- Main Content -->
            <main class="py-6">
                <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                    <div class="bg-white shadow rounded-lg">
                        <div class="px-4 py-5 sm:p-6">
                            <h2 class="text-lg leading-6 font-medium text-gray-900 mb-4">
                                Site Configuration
                            </h2>
                            <div id="loading-indicator" class="text-center py-8">
                                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto mb-2"></div>
                                <p class="text-gray-500">Loading configuration...</p>
                            </div>
                            <div id="form-container" class="hidden mt-4">
                                <form id="site-config-form" class="space-y-6">
                                    <div>
                                        <h3 class="text-md font-medium text-gray-700 border-b pb-2 mb-4">General Website Information</h3>
                                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                            <!-- Site Title -->
                                            <div>
                                                <label for="about_title" class="block text-sm font-medium text-gray-700">Site Title</label>
                                                <div class="flex items-center space-x-1 mb-1">
                                                    <button type="button" onclick="insertTag('about_title', 'b')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs font-bold rounded hover:bg-gray-300">B</button>
                                                    <button type="button" onclick="insertTag('about_title', 'i')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs italic rounded hover:bg-gray-300">I</button>
                                                    <button type="button" onclick="insertTag('about_title', 'u')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs underline rounded hover:bg-gray-300">U</button>
                                                    <button type="button" onclick="insertTag('about_title', 'br')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs rounded hover:bg-gray-300">↵</button>
                                                </div>
                                                <input type="text" id="about_title" name="about_title" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                            </div>
                                            
                                            <!-- Subtitle -->
                                            <div>
                                                <label for="about_subtitle" class="block text-sm font-medium text-gray-700">Subtitle</label>
                                                <div class="flex items-center space-x-1 mb-1">
                                                    <button type="button" onclick="insertTag('about_subtitle', 'b')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs font-bold rounded hover:bg-gray-300">B</button>
                                                    <button type="button" onclick="insertTag('about_subtitle', 'i')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs italic rounded hover:bg-gray-300">I</button>
                                                    <button type="button" onclick="insertTag('about_subtitle', 'u')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs underline rounded hover:bg-gray-300">U</button>
                                                    <button type="button" onclick="insertTag('about_subtitle', 'br')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs rounded hover:bg-gray-300">↵</button>
                                                </div>
                                                <input type="text" id="about_subtitle" name="about_subtitle" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                            </div>
                                            
                                            <!-- Description -->
                                            <div class="sm:col-span-2">
                                                <label for="about_description" class="block text-sm font-medium text-gray-700">Description</label>
                                                <div class="flex items-center space-x-1 mb-1">
                                                    <button type="button" onclick="insertTag('about_description', 'b')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs font-bold rounded hover:bg-gray-300">B</button>
                                                    <button type="button" onclick="insertTag('about_description', 'i')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs italic rounded hover:bg-gray-300">I</button>
                                                    <button type="button" onclick="insertTag('about_description', 'u')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs underline rounded hover:bg-gray-300">U</button>
                                                    <button type="button" onclick="insertTag('about_description', 'br')" class="px-2 py-1 bg-gray-200 text-gray-700 text-xs rounded hover:bg-gray-300">↵</button>
                                                </div>
                                                <textarea id="about_description" name="about_description" rows="5" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <h3 class="text-md font-medium text-gray-700 border-b pb-2 mb-4">Website Images</h3>
                                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                            <!-- Favicon URL -->
                                            <div>
                                                <label for="image_favicon_url" class="block text-sm font-medium text-gray-700">Favicon URL</label>
                                                <input type="text" id="image_favicon_url" name="image_favicon_url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                <p class="mt-1 text-xs text-gray-500">URL for the website favicon (browser tab icon)</p>
                                            </div>
                                            
                                            <!-- Logo URL -->
                                            <div>
                                                <label for="image_logo_url" class="block text-sm font-medium text-gray-700">Logo URL</label>
                                                <input type="text" id="image_logo_url" name="image_logo_url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                <p class="mt-1 text-xs text-gray-500">URL for the website logo</p>
                                            </div>
                                            
                                            <!-- Banner URL -->
                                            <div>
                                                <label for="image_banner_url" class="block text-sm font-medium text-gray-700">Banner URL</label>
                                                <input type="text" id="image_banner_url" name="image_banner_url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                <p class="mt-1 text-xs text-gray-500">URL for the website banner image</p>
                                            </div>
                                            
                                            <!-- Mobile Banner URL -->
                                            <div>
                                                <label for="image_mobile_banner_url" class="block text-sm font-medium text-gray-700">Mobile Banner URL</label>
                                                <input type="text" id="image_mobile_banner_url" name="image_mobile_banner_url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                <p class="mt-1 text-xs text-gray-500">URL for the mobile version of the banner image</p>
                                            </div>
                                            
                                            <!-- Profile Image URL -->
                                            <div>
                                                <label for="image_about_profile_url" class="block text-sm font-medium text-gray-700">Profile Image URL</label>
                                                <input type="text" id="image_about_profile_url" name="image_about_profile_url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                <p class="mt-1 text-xs text-gray-500">URL for your main profile photo</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div>
                                        <h3 class="text-md font-medium text-gray-700 border-b pb-2 mb-4">Gallery Photos</h3>
                                        <div class="grid grid-cols-1 gap-6 sm:grid-cols-2">
                                            <!-- Photo 1 URL -->
                                            <div>
                                                <label for="image_about_photo1_url" class="block text-sm font-medium text-gray-700">Photo 1 URL</label>
                                                <input type="text" id="image_about_photo1_url" name="image_about_photo1_url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                            </div>
                                            
                                            <!-- Photo 1 Alt Text -->
                                            <div>
                                                <label for="about_photo1_alt" class="block text-sm font-medium text-gray-700">Photo 1 Alt Text</label>
                                                <input type="text" id="about_photo1_alt" name="about_photo1_alt" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                <p class="mt-1 text-xs text-gray-500">Alternative text for accessibility</p>
                                            </div>
                                            
                                            <!-- Photo 2 URL -->
                                            <div>
                                                <label for="image_about_photo2_url" class="block text-sm font-medium text-gray-700">Photo 2 URL</label>
                                                <input type="text" id="image_about_photo2_url" name="image_about_photo2_url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                            </div>
                                            
                                            <!-- Photo 2 Alt Text -->
                                            <div>
                                                <label for="about_photo2_alt" class="block text-sm font-medium text-gray-700">Photo 2 Alt Text</label>
                                                <input type="text" id="about_photo2_alt" name="about_photo2_alt" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                <p class="mt-1 text-xs text-gray-500">Alternative text for accessibility</p>
                                            </div>
                                            
                                            <!-- Photo 3 URL -->
                                            <div>
                                                <label for="image_about_photo3_url" class="block text-sm font-medium text-gray-700">Photo 3 URL</label>
                                                <input type="text" id="image_about_photo3_url" name="image_about_photo3_url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                            </div>
                                            
                                            <!-- Photo 3 Alt Text -->
                                            <div>
                                                <label for="about_photo3_alt" class="block text-sm font-medium text-gray-700">Photo 3 Alt Text</label>
                                                <input type="text" id="about_photo3_alt" name="about_photo3_alt" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                <p class="mt-1 text-xs text-gray-500">Alternative text for accessibility</p>
                                            </div>
                                            
                                            <!-- Photo 4 URL -->
                                            <div>
                                                <label for="image_about_photo4_url" class="block text-sm font-medium text-gray-700">Photo 4 URL</label>
                                                <input type="text" id="image_about_photo4_url" name="image_about_photo4_url" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                            </div>
                                            
                                            <!-- Photo 4 Alt Text -->
                                            <div>
                                                <label for="about_photo4_alt" class="block text-sm font-medium text-gray-700">Photo 4 Alt Text</label>
                                                <input type="text" id="about_photo4_alt" name="about_photo4_alt" class="mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                                                <p class="mt-1 text-xs text-gray-500">Alternative text for accessibility</p>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Work Experience -->
                                    <div class="mb-8">
                                        <h3 class="text-lg font-medium text-gray-900 mb-4">Work Experience</h3>
                                        <div id="work-experience-container" class="space-y-6">
                                            <!-- Work experience items will be dynamically added here -->
                                            <p id="work-experience-loading" class="text-gray-500">Loading work experience...</p>
                                        </div>
                                        <div class="mt-4">
                                            <button type="button" id="add-work-experience" class="inline-flex items-center px-3 py-2 border border-indigo-600 text-sm leading-4 font-medium rounded-md text-indigo-700 bg-white hover:bg-indigo-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                                <svg class="-ml-0.5 mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                                                </svg>
                                                Add Work Experience
                                            </button>
                                        </div>
                                    </div>

                                    <!-- Template for new work experience items -->
                                    <template id="work-experience-template">
                                        <div class="work-experience-item bg-gray-50 rounded-md p-4 my-4 border border-gray-200">
                                            <div class="flex justify-between items-start mb-3">
                                                <h4 class="text-base font-medium text-gray-800">Work Experience Entry</h4>
                                                <button type="button" class="delete-work-experience text-red-500 hover:text-red-700 p-1 rounded-full hover:bg-red-100 focus:outline-none focus:ring-2 focus:ring-offset-1 focus:ring-red-500">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                                                    </svg>
                                                </button>
                                            </div>
                                            
                                            <input type="hidden" class="workex-id" name="workex_id">
                                            
                                            <div class="grid grid-cols-1 gap-y-4 gap-x-4 sm:grid-cols-2">
                                                <!-- Job Title -->
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700">Job Title</label>
                                                    <input type="text" class="workex-title mt-1 p-2 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md border" required>
                                                </div>
                                                
                                                <!-- Company Name -->
                                                <div>
                                                    <label class="block text-sm font-medium text-gray-700">Company Name</label>
                                                    <input type="text" class="workex-company mt-1 p-2 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md border" required>
                                                </div>
                                                
                                                <!-- Location -->
                                                <div class="sm:col-span-2">
                                                    <label class="block text-sm font-medium text-gray-700">Location</label>
                                                    <input type="text" class="workex-location mt-1 p-2 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md border">
                                                </div>
                                                
                                                <!-- Date Range -->
                                                <div class="sm:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-4 items-end">
                                                    <div>
                                                        <label class="block text-sm font-medium text-gray-700">From Date</label>
                                                        <input type="month" class="workex-from-date mt-1 p-2 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md border" required>
                                                    </div>
                                                    
                                                    <div>
                                                        <label class="block text-sm font-medium text-gray-700">To Date</label>
                                                        <input type="month" class="workex-to-date mt-1 p-2 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md border">
                                                    </div>

                                                    <div class="flex items-center pb-2">
                                                        <input type="checkbox" class="workex-current h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded">
                                                        <label class="ml-2 block text-sm text-gray-700">Current Job</label>
                                                    </div>
                                                </div>
                                                
                                                <!-- Description / Responsibilities -->
                                                <div class="sm:col-span-2">
                                                    <label class="block text-sm font-medium text-gray-700">Description / Responsibilities</label>
                                                    <textarea class="workex-description mt-1 p-2 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md border" rows="3" required></textarea>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    
                                    <div class="flex justify-end">
                                        <button type="button" id="refresh-button" class="inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 mr-2">
                                            Refresh Data
                                        </button>
                                        <button type="submit" id="save-button" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                            Save Changes
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center hidden">
        <div class="bg-white p-5 rounded-lg shadow-lg flex flex-col items-center">
            <div class="loader mb-3 w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
            <p class="text-gray-700">Saving changes...</p>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log('Admin dashboard loaded');
        
        const authLoading = document.getElementById('auth-loading');
        const notAuthenticated = document.getElementById('not-authenticated');
        const dashboardContent = document.getElementById('dashboard-content');
        const logoutButton = document.getElementById('logout-button');
        const siteConfigForm = document.getElementById('site-config-form');
        const loadingIndicator = document.getElementById('loading-indicator');
        const formContainer = document.getElementById('form-container');
        const apiError = document.getElementById('api-error');
        const saveButton = document.getElementById('save-button');
        
        // Check authentication
        checkAuth();
        
        // Insert HTML tags for formatting text fields
        function insertTag(fieldId, tag) {
            const field = document.getElementById(fieldId);
            if (!field) return;

            const start = field.selectionStart;
            const end = field.selectionEnd;
            const currentValue = field.value;
            const selectedText = currentValue.substring(start, end);

            let newValue;
            let cursorPosition = start; // Default cursor position

            if (tag === 'br') {
                // Insert <br> tag at cursor position
                newValue = currentValue.substring(0, start) + '<br>' + currentValue.substring(end);
                cursorPosition = start + 4; // Move cursor after <br>
            } else {
                // Wrap selected text or insert empty tags
                const openTag = `<${tag}>`;
                const closeTag = `</${tag}>`;
                if (selectedText) {
                    // Wrap selection
                    newValue = currentValue.substring(0, start) + openTag + selectedText + closeTag + currentValue.substring(end);
                    cursorPosition = end + openTag.length + closeTag.length; // Move cursor after the wrapped text
                } else {
                    // Insert empty tags at cursor
                    newValue = currentValue.substring(0, start) + openTag + closeTag + currentValue.substring(end);
                    cursorPosition = start + openTag.length; // Move cursor between the tags
                }
            }

            field.value = newValue;
            // Set focus and cursor position
            field.focus();
            field.selectionStart = cursorPosition;
            field.selectionEnd = cursorPosition;
        }
        
        function checkAuth() {
            console.log('Checking authentication');
            
            const token = localStorage.getItem('admin_token');
            console.log('Auth token:', token ? 'Found' : 'Not found');
            
            // Short delay to ensure the page loads properly
            setTimeout(() => {
                authLoading.classList.add('hidden');
                
                if (!token) {
                    console.log('No token found, showing not authenticated message');
                    notAuthenticated.classList.remove('hidden');
                    return;
                }
                
                // Token found, show dashboard
                console.log('Token found, showing dashboard');
                dashboardContent.classList.remove('hidden');
                loadSiteConfig();
            }, 1000);
        }
        
        function redirectToLogin() {
            window.location.href = '/admin/login';
        }
        
        // Logout handler
        logoutButton.addEventListener('click', function() {
            console.log('Logging out');
            localStorage.removeItem('admin_token');
            dashboardContent.classList.add('hidden');
            notAuthenticated.classList.remove('hidden');
        });
        
        // Load site configuration
        function loadSiteConfig() {
            console.log('Loading site configuration');
            
            // Show loading indicator
            loadingIndicator.classList.remove('hidden');
            formContainer.classList.add('hidden');
            
            // Use the confirmed working API endpoint
            const apiEndpoint = 'https://zelbc2vwg2.execute-api.eu-north-1.amazonaws.com/Staging/website-portfolio?type=site_config';
            
            console.log('Fetching from API endpoint:', apiEndpoint);
            
            fetch(apiEndpoint, {
                method: 'GET',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                mode: 'cors',
                credentials: 'omit'
            })
            .then(response => {
                console.log('API response status:', response.status);
                if (!response.ok) {
                    throw new Error(`API response not OK: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('Successfully loaded site config from API:', data);
                
                // Hide loading indicator and show form
                loadingIndicator.classList.add('hidden');
                formContainer.classList.remove('hidden');
                
                // Fix: Pass the site_config object instead of the entire response
                populateForm(data.site_config);
                
                // Load work experience data if available
                if (data.work_experience) {
                    loadWorkExperienceData(data.work_experience);
                } else {
                    // Fetch work experience data separately if not included in site config
                    fetchWorkExperienceData();
                }
            })
            .catch(error => {
                console.error('Error loading from API:', error);
                
                // Hide loading indicator
                loadingIndicator.classList.add('hidden');
                
                // Show error message
                apiError.classList.remove('hidden');
                apiError.textContent = 'Error loading configuration data: ' + error.message;
                setTimeout(() => {
                    apiError.classList.add('hidden');
                }, 5000);
                
                // Try loading from local JSON file as fallback
                console.log('Trying to load from local JSON file');
                fetch('/data/site_config.json')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Loaded from local JSON:', data);
                        let configData = data;
                        if (data.site_configs) {
                            configData = data.site_configs;
                        }
                        if (data.site_config) {
                            configData = data.site_config;
                        }
                        populateForm(configData);
                        formContainer.classList.remove('hidden');
                        
                        // Try to load work experience data from local file
                        fetch('/data/experience.json')
                            .then(response => response.json())
                            .then(expData => {
                                loadWorkExperienceData(expData);
                            })
                            .catch(err => {
                                console.error('Error loading work experience from local JSON:', err);
                                // Add empty work experience item
                                addWorkExperienceItem();
                            });
                    })
                    .catch(localError => {
                        console.error('Error loading from local JSON:', localError);
                        // Show form anyway with empty values
                        formContainer.classList.remove('hidden');
                        
                        // Add empty work experience item
                        addWorkExperienceItem();
                    });
            });
        }
        
        // Populate form with site config data
        function populateForm(config) {
            // General information
            document.getElementById('about_title').value = config.about_title || '';
            document.getElementById('about_subtitle').value = config.about_subtitle || '';
            document.getElementById('about_description').value = config.about_description || '';
            
            // Website images
            document.getElementById('image_favicon_url').value = config.image_favicon_url || '';
            document.getElementById('image_logo_url').value = config.image_logo_url || '';
            document.getElementById('image_banner_url').value = config.image_banner_url || '';
            document.getElementById('image_mobile_banner_url').value = config.image_mobile_banner_url || '';
            document.getElementById('image_about_profile_url').value = config.image_about_profile_url || '';
            
            // Gallery photos
            document.getElementById('image_about_photo1_url').value = config.image_about_photo1_url || '';
            document.getElementById('about_photo1_alt').value = config.about_photo1_alt || '';
            document.getElementById('image_about_photo2_url').value = config.image_about_photo2_url || '';
            document.getElementById('about_photo2_alt').value = config.about_photo2_alt || '';
            document.getElementById('image_about_photo3_url').value = config.image_about_photo3_url || '';
            document.getElementById('about_photo3_alt').value = config.about_photo3_alt || '';
            document.getElementById('image_about_photo4_url').value = config.image_about_photo4_url || '';
            document.getElementById('about_photo4_alt').value = config.about_photo4_alt || '';
        }
        
        // Form submission handler
        siteConfigForm.addEventListener('submit', function(event) {
            event.preventDefault();
            console.log('Form submitted');
            
            // Disable save button during submission
            saveButton.disabled = true;
            saveButton.textContent = 'Saving...';
            saveButton.classList.add('opacity-75');
            
            // Show loading overlay
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) loadingOverlay.classList.remove('hidden');
            
            // Gather form data for site configuration
            const siteConfigData = {
                about_title: document.getElementById('about_title').value,
                about_subtitle: document.getElementById('about_subtitle').value,
                about_description: document.getElementById('about_description').value,
                image_favicon_url: document.getElementById('image_favicon_url').value,
                image_logo_url: document.getElementById('image_logo_url').value,
                image_banner_url: document.getElementById('image_banner_url').value,
                image_mobile_banner_url: document.getElementById('image_mobile_banner_url').value,
                image_about_profile_url: document.getElementById('image_about_profile_url').value,
                image_about_photo1_url: document.getElementById('image_about_photo1_url').value,
                about_photo1_alt: document.getElementById('about_photo1_alt').value,
                image_about_photo2_url: document.getElementById('image_about_photo2_url').value,
                about_photo2_alt: document.getElementById('about_photo2_alt').value,
                image_about_photo3_url: document.getElementById('image_about_photo3_url').value,
                about_photo3_alt: document.getElementById('about_photo3_alt').value,
                image_about_photo4_url: document.getElementById('image_about_photo4_url').value,
                about_photo4_alt: document.getElementById('about_photo4_alt').value
            };
            
            // Get work experience data
            const workExperienceData = getWorkExperienceData();
            
            // Create the complete API payload
            const payload = {
                action: 'update_site_config',
                site_config: siteConfigData,
                work_experience: workExperienceData
            };
            
            console.log('Form data to save:', payload);
            
            // Save site configuration
            saveSiteConfig(payload);
        });

        // Show save message with appropriate styling
        function showSaveMessage(message, classNames) {
            const saveMessage = document.getElementById('save-message');
            if (saveMessage) {
                saveMessage.textContent = message;
                saveMessage.className = 'px-4 py-3 text-center border-t border-b ' + classNames;
                saveMessage.classList.remove('hidden');
            }
        }

        // Hide save message
        function hideSaveMessage() {
            const saveMessage = document.getElementById('save-message');
            if (saveMessage) {
                saveMessage.classList.add('hidden');
            }
        }

        // Add this before the saveSiteConfig function
        const API_BASE_URL = 'https://zelbc2vwg2.execute-api.eu-north-1.amazonaws.com/Staging/website-portfolio';

        // Save site configuration
        async function saveSiteConfig(payload) {
            console.log('Saving with payload:', payload);
            
            try {
                // Get authentication token
                const token = localStorage.getItem('admin_token');
                console.log('Retrieved token for save request:', token ? 'Found' : 'Not found');
                
                if (!token) {
                    // Hide loading overlay
                    const loadingOverlay = document.getElementById('loading-overlay');
                    if (loadingOverlay) loadingOverlay.classList.add('hidden');
                    
                    // Show error and re-enable save button
                    saveButton.disabled = false;
                    saveButton.textContent = 'Save Changes';
                    saveButton.classList.remove('opacity-75');
                    
                    // Show error message
                    apiError.classList.remove('hidden');
                    apiError.textContent = 'Error: Authentication token is missing. Please log out and log back in.';
                    setTimeout(() => {
                        apiError.classList.add('hidden');
                    }, 5000);
                    
                    return;
                }
                
                console.log('Sending API payload:', JSON.stringify(payload));
                
                // Save to API
                const response = await fetch(API_BASE_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(payload)
                });

                console.log('API response status:', response.status);
                const responseData = await response.json();
                console.log('Raw API response data on save:', JSON.stringify(responseData));

                // Hide loading overlay
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) loadingOverlay.classList.add('hidden');
                
                // Re-enable save button
                saveButton.disabled = false;
                saveButton.textContent = 'Save Changes';
                saveButton.classList.remove('opacity-75');

                // Validate the response
                if (response.ok && responseData.success === true) {
                    console.log('Configuration saved successfully:', responseData.message);
                    
                    // Show success message
                    apiError.classList.remove('hidden');
                    apiError.textContent = 'Configuration saved successfully!';
                    apiError.style.backgroundColor = '#d1fae5';
                    apiError.style.color = '#065f46';
                    setTimeout(() => {
                        apiError.classList.add('hidden');
                        apiError.style.backgroundColor = '';
                        apiError.style.color = '';
                    }, 3000);

                    // Refresh the configuration after saving
                    setTimeout(() => {
                        fetchConfiguration();
                    }, 1000);
                } else {
                    console.error('Invalid response from API or save failed:', responseData);
                    const errorMessage = responseData.message || 'Invalid response from API';
                    throw new Error(errorMessage);
                }
            } catch (error) {
                // Hide loading overlay
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) loadingOverlay.classList.add('hidden');
                
                // Re-enable save button
                saveButton.disabled = false;
                saveButton.textContent = 'Save Changes';
                saveButton.classList.remove('opacity-75');
                
                console.error('Error saving configuration:', error);
                
                // Show error message
                apiError.classList.remove('hidden');
                apiError.textContent = 'Error saving configuration: ' + error.message;
                apiError.style.backgroundColor = '';
                apiError.style.color = '';
                setTimeout(() => {
                    apiError.classList.add('hidden');
                }, 5000);
            }
        }

        // Fetch configuration data
        async function fetchConfiguration() {
            console.log('Refreshing configuration data');
            
            try {
                const apiEndpoint = 'https://zelbc2vwg2.execute-api.eu-north-1.amazonaws.com/Staging/website-portfolio?type=site_config';
                
                const response = await fetch(apiEndpoint, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    mode: 'cors',
                    credentials: 'omit'
                });
                
                if (!response.ok) {
                    throw new Error(`API response not OK: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Successfully refreshed site config from API:', data);
                
                // Process data - using site_config property
                populateForm(data.site_config);
                
                // Refresh work experience data if available
                if (data.work_experience) {
                    console.log('Work experience data found in API response:', data.work_experience);
                    loadWorkExperienceData(data.work_experience);
                } else {
                    console.log('No work experience data in API response, fetching separately');
                    loadWorkExperienceData();
                }
                
                return true;
            } catch (error) {
                console.error('Error refreshing configuration:', error);
                return false;
            }
        }

        // Work Experience Functions
        function initWorkExperience() {
            console.log('Initializing work experience section');
            
            // Add event listener to the "Add Work Experience" button
            const addWorkExperienceBtn = document.getElementById('add-work-experience');
            if (addWorkExperienceBtn) {
                addWorkExperienceBtn.addEventListener('click', addWorkExperienceItem);
            }
            
            // Initialize "current" checkbox behavior for existing items
            initCurrentCheckboxBehavior();
        }
        
        async function loadWorkExperienceData(existingData = null) {
            console.log('Loading work experience data...');
            
            // Re-query elements each time to ensure they are found
            const container = document.getElementById('work-experience-container');
            const loadingMsg = document.getElementById('work-experience-loading');
            
            if (!container) {
                console.error('Work experience container (#work-experience-container) not found! Cannot update UI.');
                return; // Exit if container is missing
            }
            if (!loadingMsg) {
                console.warn('Work experience loading message (#work-experience-loading) not found. Proceeding without it.');
            } else {
                 // Show loading message only if found
                 loadingMsg.style.display = 'block';
            }
            
            try {
                // Clear existing items from the container
                container.innerHTML = '';
                
                let experienceData = existingData;
                
                // If no existing data was provided, try to fetch it
                if (!experienceData) {
                    try {
                        // Use the same API endpoint as the site config but with work_experience type
                        const apiEndpoint = 'https://zelbc2vwg2.execute-api.eu-north-1.amazonaws.com/Staging/website-portfolio?type=work_experience';
                        
                        const response = await fetch(apiEndpoint, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            },
                            mode: 'cors',
                            credentials: 'omit'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`API request failed with status ${response.status}`);
                        }
                        
                        const data = await response.json();
                        console.log('Received work experience data from separate API call:', data);
                        experienceData = data.work_experience || data;
                    } catch (fetchError) {
                        console.error('Error fetching work experience data:', fetchError);
                    }
                }
                
                const items = experienceData && Array.isArray(experienceData) ? experienceData : [];

                if (items.length > 0) {
                     // Log the complete structure of the first item (if it exists)
                     console.log('First work experience item structure:', JSON.stringify(items[0], null, 2));
                    
                    // Sort items by from_date in descending order (newest first)
                    items.sort((a, b) => {
                        const dateA = a.from_date ? new Date(a.from_date) : new Date(0);
                        const dateB = b.from_date ? new Date(b.from_date) : new Date(0);
                        return dateB - dateA;
                    });
                    
                    // Add each work experience item to the container
                    items.forEach(item => {
                        console.log('Adding work experience item:', item);
                        addWorkExperienceItem(null, item);
                    });
                    
                } else {
                    console.log('No work experience data found or data is not an array, adding empty item');
                    addWorkExperienceItem(null); // Add an empty item if no data
                }
            } catch (error) {
                console.error('Error processing work experience data:', error);
                // Attempt to add an empty item even if there's an error during processing
                 if (container) {
                     container.innerHTML = ''; // Clear potentially broken state
                     addWorkExperienceItem(null);
                     // Show error message within the container
                     const errorMsg = document.createElement('p');
                     errorMsg.className = 'error-message';
                     errorMsg.textContent = 'Failed to load or process work experience data. Displaying empty item.';
                     container.appendChild(errorMsg);
                 }
            } finally {
                // Hide loading message only if it was found initially
                if (loadingMsg) {
                    loadingMsg.style.display = 'none';
                }
            }
        }
        
        function addWorkExperienceItem(e, data = {}) {
            if (e) e.preventDefault();
            
            console.log('Adding work experience item with data:', data);
            // Debug the entire work experience object
            console.log('Data object structure:', JSON.stringify(data, null, 2));
            
            const container = document.getElementById('work-experience-container');
            if (!container) {
                console.error('Work experience container not found');
                return;
            }
            
            const workExItem = document.createElement('div');
            workExItem.className = 'workex-item';
            workExItem.dataset.id = data.id || '';
            
            // Debug log to see what's in the job_title field
            console.log('Job title from data:', data.job_title);
            console.log('Company name from data:', data.company_name);
            
            // Create job title field
            const titleLabel = document.createElement('label');
            titleLabel.textContent = 'Job Title*:';
            const titleInput = document.createElement('input');
            titleInput.type = 'text';
            titleInput.className = 'workex-title';
            titleInput.required = true;
            titleInput.value = data.job_title || '';
            titleInput.placeholder = 'e.g. Software Engineer';
            
            // Create company name field
            const companyLabel = document.createElement('label');
            companyLabel.textContent = 'Company*:';
            const companyInput = document.createElement('input');
            companyInput.type = 'text';
            companyInput.className = 'workex-company';
            companyInput.required = true;
            companyInput.value = data.company_name || '';
            companyInput.placeholder = 'e.g. Tech Company Inc.';
            
            // Create location field
            const locationLabel = document.createElement('label');
            locationLabel.textContent = 'Location:';
            const locationInput = document.createElement('input');
            locationInput.type = 'text';
            locationInput.className = 'workex-location';
            locationInput.value = data.location || '';
            locationInput.placeholder = 'e.g. New York, NY';
            
            // Create dates container
            const datesContainer = document.createElement('div');
            datesContainer.className = 'workex-dates';
            
            // From date field
            const fromLabel = document.createElement('label');
            fromLabel.textContent = 'From:';
            const fromInput = document.createElement('input');
            fromInput.type = 'date';
            fromInput.className = 'workex-from-date';
            fromInput.value = data.from_date || '';
            
            // To date field
            const toLabel = document.createElement('label');
            toLabel.textContent = 'To:';
            const toInput = document.createElement('input');
            toInput.type = 'date';
            toInput.className = 'workex-to-date';
            toInput.value = data.to_date || '';
            
            // Current job checkbox
            const currentContainer = document.createElement('div');
            currentContainer.className = 'workex-current';
            const currentLabel = document.createElement('label');
            currentLabel.textContent = 'Current Job:';
            const currentInput = document.createElement('input');
            currentInput.type = 'checkbox';
            currentInput.className = 'workex-is-current';
            currentInput.checked = !!data.is_current;
            
            // Add event listener to disable to_date if current job is checked
            currentInput.addEventListener('change', function() {
                toInput.disabled = this.checked;
                if (this.checked) {
                    toInput.value = '';
                }
            });
            
            // Set initial state of to_date based on is_current
            toInput.disabled = currentInput.checked;
            
            // Add date fields to date container
            datesContainer.appendChild(fromLabel);
            datesContainer.appendChild(fromInput);
            datesContainer.appendChild(toLabel);
            datesContainer.appendChild(toInput);
            currentContainer.appendChild(currentLabel);
            currentContainer.appendChild(currentInput);
            datesContainer.appendChild(currentContainer);
            
            // Create description field
            const descLabel = document.createElement('label');
            descLabel.textContent = 'Description:';
            const descInput = document.createElement('textarea');
            descInput.className = 'workex-description';
            descInput.value = data.description || '';
            descInput.placeholder = 'Describe your responsibilities and achievements...';
            descInput.rows = 4;
            
            // Create delete button
            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'workex-delete-btn';
            deleteBtn.textContent = 'Delete';
            
            // Add a hidden input to track deletion status
            const deletedInput = document.createElement('input');
            deletedInput.type = 'hidden';
            deletedInput.className = 'workex-is-deleted';
            // Initialize based on DB state if available (should always be 0 when adding)
            deletedInput.value = '0'; 
            workExItem.appendChild(deletedInput);

            // Modify the delete button's event listener
            deleteBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Mark this item for deletion? It will be removed when you save changes.')) {
                    // Mark as deleted by setting the hidden input value
                    const hiddenDeleteInput = workExItem.querySelector('.workex-is-deleted');
                    if (hiddenDeleteInput) {
                        hiddenDeleteInput.value = '1';
                    }
                    // Add a visual cue 
                    workExItem.classList.add('marked-for-deletion');
                    
                    // Disable fields and change button state
                    workExItem.querySelectorAll('input:not([type="hidden"]), textarea').forEach(el => {
                       el.disabled = true;
                    });
                    deleteBtn.textContent = 'Marked for Deletion';
                    deleteBtn.disabled = true;
                    console.log(`Marked item ID ${workExItem.dataset.id || '(new)'} for deletion.`);
                }
            });
            
            // Add fields to work experience item
            workExItem.appendChild(titleLabel);
            workExItem.appendChild(titleInput);
            workExItem.appendChild(companyLabel);
            workExItem.appendChild(companyInput);
            workExItem.appendChild(locationLabel);
            workExItem.appendChild(locationInput);
            workExItem.appendChild(datesContainer);
            workExItem.appendChild(descLabel);
            workExItem.appendChild(descInput);
            workExItem.appendChild(deleteBtn);
            
            // Add work experience item to container
            container.appendChild(workExItem);
            
            return workExItem;
        }
        
        function initCurrentCheckboxBehavior() {
            // Find checkboxes within the dynamically added .workex-item elements
            const checkboxes = document.querySelectorAll('.workex-item .workex-is-current'); 
            checkboxes.forEach(checkbox => {
                // Find the parent .workex-item and then the date input within it
                const parentItem = checkbox.closest('.workex-item'); 
                if (!parentItem) return; // Skip if parent item not found
                
                const toDateInput = parentItem.querySelector('.workex-to-date');
                if (toDateInput) {
                    // Set initial state
                    if (checkbox.checked) {
                        toDateInput.disabled = true;
                        toDateInput.value = ''; // Clear value when disabled
                    } else {
                        toDateInput.disabled = false; 
                    }
                    
                    // Add change listener
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            toDateInput.disabled = true;
                            toDateInput.value = ''; // Clear value when disabled
                        } else {
                            toDateInput.disabled = false;
                        }
                    });
                }
            });
        }
        
        function getWorkExperienceData() {
            const workExItems = document.querySelectorAll('.workex-item');
            const data = [];
            
            workExItems.forEach(item => {
                const jobTitle = item.querySelector('.workex-title')?.value || '';
                const company = item.querySelector('.workex-company')?.value || '';
                
                // Do NOT skip items marked for deletion, we need to send their status
                // if (!jobTitle.trim() || !company.trim()) {
                //    console.log('Skipping work experience item with empty required fields');
                //    return;
                // }
                
                // Build work experience data object with correct field names
                const workExData = {
                    id: item.dataset.id || '',
                    job_title: jobTitle,
                    company_name: company,
                    location: item.querySelector('.workex-location')?.value || '',
                    from_date: item.querySelector('.workex-from-date')?.value || '',
                    to_date: item.querySelector('.workex-to-date')?.value || '',
                    is_current: item.querySelector('.workex-is-current')?.checked || false,
                    description: item.querySelector('.workex-description')?.value || '',
                    // Add the deletion status from the hidden input
                    is_deleted: parseInt(item.querySelector('.workex-is-deleted')?.value || '0', 10) // Default to 0 if not found
                };
                
                // Only include items if they have required fields OR are marked for deletion
                if ((jobTitle.trim() && company.trim()) || workExData.is_deleted === 1) {
                    console.log('Created work experience data object:', workExData);
                    data.push(workExData);
                } else {
                    console.log('Skipping item with empty required fields that is NOT marked for deletion:', item.dataset.id);
                }
            });
            
            console.log('Collected work experience data:', data);
            return data;
        }

        // Initialize work experience function on load
        initWorkExperience();

        // Add refresh button event listener
        const refreshButton = document.getElementById('refresh-button');
        if (refreshButton) {
            refreshButton.addEventListener('click', function() {
                console.log('Refreshing data');
                // Show loading indicator
                if (loadingIndicator) loadingIndicator.classList.remove('hidden');
                if (formContainer) formContainer.classList.add('hidden');
                
                // Load configuration again
                loadSiteConfig();
            });
        }
    });
    </script>
</body>
</html> 